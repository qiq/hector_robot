<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Config SYSTEM "hector_config.dtd">
<!--
-->
<Config>
	<Server id="robot" lib="RobotServer.la">
		<threads>1</threads>
		<serverHost>*</serverHost>
		<serverPort>1100</serverPort>
		<logConfig>robot.log.props.trace</logConfig>
		<ProcessingEngine id="PE_robot">
			<Processor id="P_load">
				<threads>1</threads>
				<modules>
					<Module id="M_load" lib="Load.la">
						<param name="filename" value="$1"/>
					</Module>
					<Module id="M_load_filter" type="perl" lib="Filter.pm">
						<param name="filterFile" value="filter.txt"/>
					</Module>
					<Module id="M_load_dump" lib="Dump.la"/>
				</modules>
				<output>
					<nextProcessor ref="P_main"/>
				</output>
			</Processor>
			<Processor id="P_main">
				<threads>1</threads>
				<input>
					<queue maxItems="100"/>	<!-- default queue -->
					<queue priority="100"/>	<!-- redirect queue -->
				</input>
				<modules>
					<Module id="M_wsm" lib="WebSiteManager.la">
						<param name="dnsEngine" value="PE_dns"/>
						<param name="robotsEngine" value="PE_robots"/>
						<param name="timeTick" value="100000"/>
					</Module>
				</modules>
				<output>
					<nextProcessor ref="P_newlink" filter="2"/>
					<nextProcessor ref="P_fetch"/>
				</output>
			</Processor>

			<Processor id="P_fetch">
				<threads>1</threads>
				<input>
					<queue/>
				</input>
				<modules>
					<Module id="M_robotsfilter" type="perl" lib="RobotsFilter.pm">
						<param name="wildcards" value="0"/>
						<param name="logLevel" value="INFO"/>
					</Module>
					<Module id="M_prefetch" type="perl" lib="PreFetch.pm"/>
					<Module id="M_fetch" lib="Fetcher.la">
						<param name="timeTick" value="100000"/>
						<param name="maxRequests" value="100"/>
						<param name="minServerRelax" value="10"/>
						<param name="userAgent" value="Mozilla/5.0 (compatible; HectorBot/0.1; +http://hector.ms.mff.cuni.cz/crawler)"/>
						<param name="from" value="spousta@ufal.mff.cuni.cz"/>
						<param name="allowedContentTypes" value="text/plain text/html application/msword"/>
					</Module>
					<Module id="M_postfetch" type="perl" lib="PostFetch.pm"/>
					<Module id="M_scheduler" lib="Scheduler.la">
						<param name="outputDir" value="refresh"/>
					</Module>
					<Module id="M_extractor" lib="UrlExtractor.la"/>
				</modules>
				<output>
					<nextProcessor ref="P_backlink" filter="1"/>
					<nextProcessor ref="P_backlink" filter="2"/>
					<nextProcessor ref="P_postprocess"/>
				</output>
			</Processor>

			<Processor id="P_backlink">
				<threads>1</threads>
				<input>
					<queue/>
				</input>
				<modules>
					<Module id="M_backlink_fix_redirect" type="perl" lib="FixRedirect.pm"/>
					<Module id="M_backlink_filter" type="perl" lib="Filter.pm">
						<param name="filterFile" value="filter.txt"/>
						<param name="logLevel" value="INFO"/>
					</Module>
				</modules>
				<output>
					<nextProcessor ref="P_main" priority="100"/>
				</output>
			</Processor>
		
			<Processor id="P_newlink">
				<threads>1</threads>
				<input>
					<queue/>
				</input>
				<modules>
					<Module id="M_newlink_linkfilter" type="perl" lib="NewLinkFilter.pm"/>
					<Module id="M_newlink_save" lib="Save.la">
						<param name="filename" value="refresh/newlink"/>
					</Module>
				</modules>
			</Processor>
			<Processor id="P_postprocess">
				<threads>1</threads>
				<input>
					<queue/>
				</input>
				<modules>
					<!--Module id="M_postprocess_dump" lib="Dump.la"/-->
					<Module id="M_postprocess_save" lib="Save.la">
						<param name="filename" value="refresh/data"/>
					</Module>
				</modules>
			</Processor>
		</ProcessingEngine>

		<ProcessingEngine id="PE_dns">
                        <inputProcessor ref="P_dns"/>
			<Processor id="P_dns">
				<threads>1</threads>
				<modules>
					<!--Module id="M_dump_dns1" lib="Dump.la"/-->
					<Module id="M_dns" lib="DnsResolver.la">
						<param name="forwardServer" value="127.0.0.1"/>
						<param name="forwardPort" value="53"/>
						<param name="negativeTTL" value="86400"/>
					</Module>
					<!--Module id="M_dump_dns2" lib="Dump.la"/-->
				</modules>
                                <input>
                                        <queue/>
                                </input>
                                <output>
                                        <nextProcessor ref="PE_dns"/>
                                </output>
			</Processor>
		</ProcessingEngine>

		<ProcessingEngine id="PE_robots">
                        <inputProcessor ref="P_robots"/>
			<Processor id="P_robots">
				<threads>1</threads>
				<modules>
					<Module id="M_fetch_robots" lib="Fetcher.la">
						<param name="timeTick" value="100000"/>
						<param name="maxRequests" value="1000"/>
						<param name="minServerRelax" value="5"/>
						<param name="userAgent" value="Mozilla/5.0 (compatible; HectorBot/0.1; +http://hector.ms.mff.cuni.cz/crawler)"/>
						<param name="from" value="spousta@ufal.mff.cuni.cz"/>
						<param name="allowedContentTypes" value="text/plain"/>
					</Module>
					<Module id="M_parse_robots" type="perl" lib="RobotsParser.pm">
						<param name="TTL" value="86400"/>
						<param name="negativeTTL" value="86400"/>
						<param name="wildcards" value="0"/>
					</Module>
				</modules>
                                <input>
                                        <queue/>
                                </input>
                                <output>
                                        <nextProcessor ref="PE_robots"/>
                                </output>
			</Processor>
		</ProcessingEngine>
	</Server>
</Config>
